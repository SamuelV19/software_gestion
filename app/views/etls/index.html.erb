<div class="container-fluid py-4" style="background-color: #F9F8F4;">

  <!-- Título y botones -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-dark" style="color: #4A4A4A;">ETL de Inventario</h1>

    <div>
      <%= link_to "Volver a ventas", sales_path, class: "btn me-2", style: "background-color: #4A4A4A; color: white;" %>
      <%= link_to "Admin", admin_root_path, class: "btn", style: "background-color: #4A4A4A; color: white;" %>
    </div>
  </div>

  <!-- Cargar CSV -->
  <div class="card mb-4" style="background-color: #F4EDE4; border: 1px solid #E7B288;">
    <div class="card-body">
      <h4 class="mb-3" style="color: #4A4A4A;">Actualizar inventario desde CSV</h4>

      <%= form_with url: etl_run_path, local: true, multipart: true, class: "row g-3 align-items-end" do |f| %>
        <div class="col-md-6">
          <label class="form-label" style="color: #4A4A4A;">Archivo CSV:</label>
          <%= f.file_field :file, class: "form-control" %>
        </div>

        <div class="col-md-auto">
          <%= f.submit "Ejecutar ETL con CSV", class: "btn", style: "background-color: #C97B49; color: white;" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Botón API -->
  <div class="card mb-4" style="background-color: #F4EDE4; border: 1px solid #E7B288;">
    <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h4 class="mb-2" style="color: #4A4A4A;">Actualizar desde API del proveedor</h4>
        <p class="text-muted mb-0">Obtiene automáticamente el catálogo de productos del proveedor externo.</p>
      </div>

      <%= link_to "Ejecutar ETL desde API", etl_run_path, class: "btn mt-3 mt-md-0", style: "background-color: #7A9E7E; color: white;" %>
    </div>
  </div>

  <!-- Historial de cambios -->
  <h3 class="mb-3" style="color: #4A4A4A;">Cambios recientes del ETL</h3>

  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle" style="background-color: #F4EDE4;">
      <thead style="background-color: #E7B288; color: #4A4A4A;">
        <tr>
          <th>Producto</th>
          <th>Cambio</th>
          <th>Antes</th>
          <th>Después</th>
          <th>Fecha</th>
        </tr>
      </thead>

      <tbody>
        <% if @etl_logs.any? %>
          <% @etl_logs.each do |log| %>
            <tr>
              <td><%= log.product.nombre %></td>
              <td>
                <% case log.cambio %>
                  <% when "precio" %>
                    <span class="fw-bold" style="color: #C97B49;">Precio</span>
                  <% when "stock" %>
                    <span class="fw-bold" style="color: #7A9E7E;">Stock</span>
                  <% when "descripcion" %>
                    <span class="fw-bold" style="color: #4A4A4A;">Descripción</span>
                  <% when "nuevo_producto" %>
                    <span class="fw-bold" style="color: #4A4A4A;">Nuevo producto</span>
                  <% end %>
              </td>
              <td><%= log.valor_anterior %></td>
              <td><%= log.valor_nuevo %></td>
              <td><%= log.created_at.strftime("%d/%m/%Y %H:%M") %></td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="5" class="text-center text-muted py-3">Aún no hay registros del ETL</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

</div>
